<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Qu·∫£n l√Ω User</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body class="bg-light">

<div class="container my-4">
    <h2 class="text-primary mb-4">üìã Danh s√°ch User</h2>

    <!-- B·∫£ng Users -->
    <table class="table table-info table-striped table-bordered align-middle shadow-sm" id="userTable">
        <thead class="table-primary text-center">
            <tr>
                <th>ID</th>
                <th>Fullname</th>
                <th>Email</th>
                <th>Phone</th>
                <th>H√†nh ƒë·ªông</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <hr class="my-4">

    <!-- Form th√™m User -->
    <h2 class="text-primary mb-3">‚ûï Th√™m User</h2>
    <form id="addUserForm" class="row g-3 bg-white p-3 border rounded shadow-sm">
        <div class="col-md-6">
            <label class="form-label">Fullname</label>
            <input type="text" class="form-control border-primary" id="fullname" placeholder="Nh·∫≠p t√™n ƒë·∫ßy ƒë·ªß">
        </div>
        <div class="col-md-6">
            <label class="form-label">Email</label>
            <input type="email" class="form-control border-primary" id="email" placeholder="Nh·∫≠p email">
        </div>
        <div class="col-md-6">
            <label class="form-label">Password</label>
            <input type="password" class="form-control border-primary" id="password" placeholder="Nh·∫≠p m·∫≠t kh·∫©u">
        </div>
        <div class="col-md-6">
            <label class="form-label">Phone</label>
            <input type="text" class="form-control border-primary" id="phone" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i">
        </div>
        <div class="col-12">
            <button type="submit" class="btn btn-primary w-100">üíæ Th√™m</button>
        </div>
    </form>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // Load to√†n b·ªô user
    function loadUsers() {
        const query = `
            query {
                getAllUsers {
                    id
                    fullname
                    email
                    phone
                }
            }
        `;
        $.ajax({
            url: "/graphql",
            method: "POST",
            contentType: "application/json",
            data: JSON.stringify({ query }),
            success: function(response) {
                const users = response.data.getAllUsers;
                let rows = "";
                users.forEach(u => {
                    rows += `<tr>
                                <td>${u.id}</td>
                                <td>${u.fullname}</td>
                                <td>${u.email}</td>
                                <td>${u.phone}</td>
                                <td class="text-center">
                                    <button class="btn btn-sm btn-outline-danger me-1" onclick="deleteUser(${u.id})">üóëÔ∏è X√≥a</button>
                                    <button class="btn btn-sm btn-outline-primary" onclick="editUser(${u.id}, '${u.fullname}', '${u.email}', '${u.phone}')">‚úèÔ∏è S·ª≠a</button>
                                </td>
                             </tr>`;
                });
                $("#userTable tbody").html(rows);
            }
        });
    }

    // X√≥a user
    function deleteUser(id) {
        if (!confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a user n√†y?")) return;
        const mutation = `
            mutation {
                deleteUser(id: ${id})
            }
        `;
        $.ajax({
            url: "/graphql",
            method: "POST",
            contentType: "application/json",
            data: JSON.stringify({ query: mutation }),
            success: function() {
                alert("‚úÖ X√≥a th√†nh c√¥ng!");
                loadUsers();
            }
        });
    }

    // S·ª≠a user
    function editUser(id, fullname, email, phone) {
        const newName = prompt("Nh·∫≠p fullname:", fullname);
        if (!newName) return;
        const newEmail = prompt("Nh·∫≠p email:", email);
        if (!newEmail) return;
        const newPhone = prompt("Nh·∫≠p phone:", phone);
        if (!newPhone) return;
        const newPass = prompt("Nh·∫≠p m·∫≠t kh·∫©u m·ªõi:", "123");
        if (!newPass) return;

        const mutation = `
            mutation {
                updateUser(
                    id: ${id},
                    fullname: "${newName}",
                    email: "${newEmail}",
                    phone: "${newPhone}",
                    password: "${newPass}"
                ) {
                    id fullname email phone
                }
            }
        `;
        $.ajax({
            url: "/graphql",
            method: "POST",
            contentType: "application/json",
            data: JSON.stringify({ query: mutation }),
            success: function() {
                alert("‚úÖ C·∫≠p nh·∫≠t th√†nh c√¥ng!");
                loadUsers();
            }
        });
    }

    // Th√™m user
    $("#addUserForm").submit(function(e) {
        e.preventDefault();
        const fullname = $("#fullname").val();
        const email = $("#email").val();
        const password = $("#password").val();
        const phone = $("#phone").val();

        const mutation = `
            mutation {
                createUser(
                    fullname: "${fullname}",
                    email: "${email}",
                    password: "${password}",
                    phone: "${phone}"
                ) {
                    id fullname email phone
                }
            }
        `;
        $.ajax({
            url: "/graphql",
            method: "POST",
            contentType: "application/json",
            data: JSON.stringify({ query: mutation }),
            success: function() {
                alert("‚úÖ Th√™m th√†nh c√¥ng!");
                $("#addUserForm")[0].reset();
                loadUsers();
            }
        });
    });

    $(document).ready(function() {
        loadUsers();
    });
</script>

</body>
</html>
