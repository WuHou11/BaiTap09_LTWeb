<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Qu·∫£n l√Ω Category</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body class="bg-light">

<div class="container my-4">
    <h2 class="text-success mb-4">Qu·∫£n l√Ω Category</h2>

    <!-- Form th√™m / s·ª≠a -->
    <form id="categoryForm" class="row g-3 bg-white p-3 border rounded shadow-sm">
        <input type="hidden" id="categoryId">
        <div class="col-md-5">
            <label class="form-label">Name</label>
            <input type="text" class="form-control border-success" id="categoryName" placeholder="T√™n Category">
        </div>
        <div class="col-md-5">
            <label class="form-label">Images</label>
            <input type="text" class="form-control border-success" id="categoryImages" placeholder="Link h√¨nh ·∫£nh">
        </div>
        <div class="col-md-2 d-flex align-items-end">
            <button type="submit" class="btn btn-success w-100">üíæ L∆∞u</button>
        </div>
    </form>

    <hr class="my-4">

    <table class="table table-success table-striped table-bordered text-center align-middle shadow-sm" id="categoryTable">
        <thead class="table-success">
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Images</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
    function loadCategories() {
        const query = `
            query {
                getAllCategories {
                    id
                    name
                    images
                }
            }
        `;

        $.ajax({
            url: "/graphql",
            method: "POST",
            contentType: "application/json",
            data: JSON.stringify({ query }),
            success: function(response) {
                const categories = response.data.getAllCategories;
                let rows = "";
                categories.forEach(c => {
                    rows += `<tr>
                                <td>${c.id}</td>
                                <td>${c.name}</td>
                                <td>${c.images || ""}</td>
                                <td>
                                    <button class="btn btn-sm btn-outline-success me-1"
                                            onclick="editCategory(${c.id}, '${c.name}', '${c.images || ""}')">
                                        ‚úèÔ∏è S·ª≠a
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger"
                                            onclick="deleteCategory(${c.id})">
                                        üóëÔ∏è X√≥a
                                    </button>
                                </td>
                             </tr>`;
                });
                $("#categoryTable tbody").html(rows);
            }
        });
    }

    // Th√™m / c·∫≠p nh·∫≠t Category
    $("#categoryForm").submit(function(e) {
        e.preventDefault();
        const id = $("#categoryId").val();
        const name = $("#categoryName").val();
        const images = $("#categoryImages").val();

        let query, variables;
        if (id) {
            // Update
            query = `
                mutation($id: ID!, $name: String!, $images: String) {
                    updateCategory(id: $id, name: $name, images: $images) {
                        id
                        name
                        images
                    }
                }
            `;
            variables = { id: parseInt(id), name, images };
        } else {
            // Create
            query = `
                mutation($name: String!, $images: String) {
                    createCategory(name: $name, images: $images) {
                        id
                        name
                        images
                    }
                }
            `;
            variables = { name, images };
        }

        $.ajax({
            url: "/graphql",
            method: "POST",
            contentType: "application/json",
            data: JSON.stringify({ query, variables }),
            success: function() {
                $("#categoryForm")[0].reset();
                $("#categoryId").val("");
                loadCategories();
            }
        });
    });

    // X√≥a Category
    function deleteCategory(id) {
        const query = `
            mutation($id: ID!) {
                deleteCategory(id: $id)
            }
        `;
        const variables = { id: parseInt(id) };

        $.ajax({
            url: "/graphql",
            method: "POST",
            contentType: "application/json",
            data: JSON.stringify({ query, variables }),
            success: function() {
                loadCategories();
            }
        });
    }

    // S·ª≠a Category
    function editCategory(id, name, images) {
        $("#categoryId").val(id);
        $("#categoryName").val(name);
        $("#categoryImages").val(images);
    }

    $(document).ready(function() {
        loadCategories();
    });
</script>

</body>
</html>
